{
  "info": {
    "_postman_id": "d3b111bc-c08f-4d9b-bc22-7e2c702b4c11",
    "name": "Homestay Approval Flow",
    "description": "Covers the core flow where a host creates a homestay and an admin reviews and approves it.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Host - Create Homestay",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{hostToken}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"Lakeview Retreat\",\n  \"description\": \"Cozy homestay overlooking the lake with private deck and fireplace.\",\n  \"category\": \"ENTIRE_HOME\",\n  \"minGuest\": 1,\n  \"maxGuest\": 4,\n  \"numBedrooms\": 2,\n  \"numBeds\": 3,\n  \"numBathrooms\": 1,\n  \"numKitchen\": 1,\n  \"address\": {\n    \"addressLine\": \"123 Lakeside Drive\",\n    \"city\": \"Da Lat\",\n    \"state\": \"Lam Dong\"\n  },\n  \"facilitiesIds\": [1, 2],\n  \"amenities\": [\n    {\n      \"name\": \"Kayak Rental\",\n      \"description\": \"Two single kayaks available for guests\",\n      \"imageUrl\": \"https://cdn.example.com/amenities/kayak.png\"\n    }\n  ],\n  \"imageUrls\": [\n    {\n      \"imageUrl\": \"https://cdn.example.com/homestays/lakeview/main.jpg\",\n      \"isPrimary\": true\n    },\n    {\n      \"imageUrl\": \"https://cdn.example.com/homestays/lakeview/living-room.jpg\",\n      \"isPrimary\": false\n    }\n  ],\n  \"rules\": [\n    {\n      \"description\": \"No parties after 10pm\",\n      \"ruleTypeHomestay\": \"HOUSE_RULE\"\n    }\n  ],\n  \"dailyPrices\": [\n    {\n      \"day\": \"2024-12-01T00:00:00Z\",\n      \"price\": 75.0\n    },\n    {\n      \"day\": \"2024-12-02T00:00:00Z\",\n      \"price\": 80.0\n    }\n  ]\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/hosts/me/homestays",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "hosts",
            "me",
            "homestays"
          ]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Host create homestay - status 201\", function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "const response = pm.response.json();",
              "pm.test(\"Response contains homestay data\", function () {",
              "    pm.expect(response).to.have.property('data');",
              "    pm.expect(response.data).to.have.property('id');",
              "    pm.expect(response.data.status).to.eql('PENDING');",
              "});",
              "",
              "const homestayId = pm.response.json().data.id;",
              "pm.collectionVariables.set('homestayId', homestayId);",
              "pm.test(\"Homestay id stored for admin flow\", function () {",
              "    pm.expect(homestayId).to.be.a('number');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Admin - List Pending Homestays",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{adminToken}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/admins/homestays?status=PENDING&page=0&size=10",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "admins",
            "homestays"
          ],
          "query": [
            {
              "key": "status",
              "value": "PENDING"
            },
            {
              "key": "page",
              "value": "0"
            },
            {
              "key": "size",
              "value": "10"
            }
          ]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Admin list pending homestays - status 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "const payload = pm.response.json();",
              "pm.test(\"Payload contains page metadata\", function () {",
              "    pm.expect(payload.data).to.have.property('total');",
              "    pm.expect(payload.data).to.have.property('items');",
              "});",
              "",
              "const items = payload.data.items || [];",
              "pm.test(\"Pending list includes created homestay\", function () {",
              "    const storedId = Number(pm.collectionVariables.get('homestayId'));",
              "    const found = items.some(item => item.id === storedId);",
              "    pm.expect(found, 'created homestay present in pending list').to.be.true;",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Admin - Get Homestay Detail",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{adminToken}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/admins/homestays/{{homestayId}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "admins",
            "homestays",
            "{{homestayId}}"
          ]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Admin detail view - status 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "const result = pm.response.json();",
              "pm.test(\"Detail response returns matching homestay\", function () {",
              "    const storedId = Number(pm.collectionVariables.get('homestayId'));",
              "    pm.expect(result.data.id).to.eql(storedId);",
              "    pm.expect(result.data.status).to.eql('PENDING');",
              "});",
              "",
              "pm.test(\"Detail response includes images, rules, and pricing\", function () {",
              "    pm.expect(result.data.images).to.be.an('array');",
              "    pm.expect(result.data.rules).to.be.an('array');",
              "    pm.expect(result.data.dailyPrices).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Admin - Approve Homestay",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{adminToken}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/admins/homestays/{{homestayId}}/approve",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "admins",
            "homestays",
            "{{homestayId}}",
            "approve"
          ]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Admin approve homestay - status 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "const result = pm.response.json();",
              "pm.test(\"Homestay status switches to ACTIVE\", function () {",
              "    pm.expect(result.data.status).to.eql('ACTIVE');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ],
  "event": [],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080"
    },
    {
      "key": "hostToken",
      "value": "{{HOST_ACCESS_TOKEN}}"
    },
    {
      "key": "adminToken",
      "value": "{{ADMIN_ACCESS_TOKEN}}"
    }
  ]
}
